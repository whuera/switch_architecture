<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>
        <%= title %>
    </title>
    <link rel="stylesheet" href="/css/index.css">
</head>

<body>

    <!-- GitHub Top Header -->
    <header class="github-header">
        <div class="header-left">
            <button class="menu-toggle">☰</button>
            <div class="repo-path">
                <a href="#" class="repo-owner">whuera</a>
                <span class="separator">/</span>
                <a href="#" class="repo-name">switch_architecture</a>
            </div>
        </div>

        <div class="header-center">
            <div class="search-bar">
                <input type="text" placeholder="Type / to search">
            </div>
        </div>

        <div class="header-right">
            <button class="header-btn">+</button>
            <button class="header-btn">🔔</button>
            <div class="user-avatar">👤</div>
        </div>
    </header>

    <!-- GitHub Navigation Tabs -->
    <nav class="github-nav">
        <div class="nav-container">
            <a href="#" class="nav-item active">
                <span class="nav-icon">📝</span>
                Arquitectura
            </a>
            <a href="#" class="nav-item">
                <span class="nav-icon">⚠️</span>
                Issues
            </a>
            <a href="#" class="nav-item">
                <span class="nav-icon">🔀</span>
                Pull requests
            </a>
            <a href="#" class="nav-item">
                <span class="nav-icon">▶️</span>
                Actions
            </a>
            <a href="#" class="nav-item" id="componentes-nav">
                <span class="nav-icon">🔧</span>
                Componentes
            </a>
            <a href="#" class="nav-item">
                <span class="nav-icon">📚</span>
                Wiki
            </a>
            <a href="#" class="nav-item">
                <span class="nav-icon">🔒</span>
                Security
            </a>
            <a href="#" class="nav-item">
                <span class="nav-icon">📊</span>
                Insights
            </a>
            <a href="#" class="nav-item" id="simuladores-nav">
                <span class="nav-icon">⚙️</span>
                Simuladores
            </a>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="github-container">

        <!-- Main Content Area -->
        <main class="main-area">

            <!-- Inicio Section (Default view) -->
            <div id="inicio-section" class="inicio-section">
                <div class="inicio-card">
                    <h2>🏠 Inicio</h2>
                    <div class="inicio-content">
                        <img src="/images/arquitectura-diagram.png" alt="Diagrama de Arquitectura"
                            class="arquitectura-diagram">
                    </div>

                    <div class="description-content">
                        <br>
                        <p class="intro-text">
                            Cuando una transacción financiera (ATM, POS, e-commerce o ISO8583) llega a BASE24-eps, ésta
                            sigue una serie de pasos ordenados y modulares que garantizan validación, enrutamiento,
                            autorización y retorno seguro al canal originador.
                        </p>

                        <div class="step-section">
                            <h3>✅ 1. Llegada al Originator</h3>
                            <p>La transacción ingresa por un <strong>Originator process</strong> (ISOORI, ATMORI,
                                POSORI, HISOORI).</p>
                            <p>Este componente:</p>
                            <ul>
                                <li>Recibe el mensaje desde el canal.</li>
                                <li>Valida formato, MTI, longitudes y campos mínimos.</li>
                                <li>Lo parsea según el Message Profile.</li>
                                <li>Lo convierte a un Transaction Entity interno.</li>
                                <li>Es la puerta de entrada al ecosistema eps.</li>
                            </ul>
                        </div>

                        <div class="step-section">
                            <h3>✅ 2. Journalización inicial</h3>
                            <p>Antes de procesarse, el mensaje se registra en el <strong>Journal Service</strong>,
                                asegurando trazabilidad y capacidad de recuperación ante fallas.</p>
                        </div>

                        <div class="step-section">
                            <h3>✅ 3. Determinación del enrutamiento (Routing Engine)</h3>
                            <p>BASE24-eps decide qué hacer con la transacción usando dos capas:</p>

                            <h4>a) Source Routing (SRC_RTE)</h4>
                            <p>Evalúa:</p>
                            <ul>
                                <li>PAN / BIN</li>
                                <li>Tipo de transacción</li>
                                <li>Canal (ATM, POS, Switch externo)</li>
                                <li>Institution ID</li>
                            </ul>
                            <p>Y produce un <strong>Route Code</strong>, que representa la lógica de destino.</p>

                            <h4>b) Destination Routing (DST_RTE)</h4>
                            <p>Determina si la transacción se autoriza:</p>
                            <ul>
                                <li><strong>On-Us</strong> (autorización interna)</li>
                                <li>En un <strong>host externo</strong> (core del banco)</li>
                                <li>En un <strong>switch internacional</strong> (Visa, MC, Plus, Redbanc)</li>
                            </ul>
                            <p>También define fallback, reintentos, prioridades y formato del mensaje hacia el destino.
                            </p>
                        </div>

                        <div class="step-section">
                            <h3>✅ 4. Envío a Autorización (AUTH)</h3>
                            <p>El Originator entrega la transacción ya normalizada a <strong>AUTH</strong>, el motor de
                                autorización.</p>
                            <p>AUTH determina el entorno de autorización (Authorization Environment) y aplica:</p>
                            <ul>
                                <li>Validación del PIN y MAC</li>
                                <li>Reglas EMV (ARQC, TVR, CVR)</li>
                                <li>Límites de cliente</li>
                                <li>Reglas de riesgo</li>
                                <li>Comportamiento On-Us o External Host</li>
                            </ul>
                        </div>

                        <div class="step-section">
                            <h3>🔵 5. Autorización Interna o Externa</h3>

                            <h4>Autorización On-Us (Interna)</h4>
                            <p>eps ejecuta validaciones propias del banco, y decide aprobar o rechazar.</p>

                            <h4>Autorización mediante Host Externo</h4>
                            <p>Si requiere consulta a un sistema externo:</p>
                            <ul>
                                <li>AUTH envía el mensaje a través del <strong>Message Delivery Service (MDS)</strong>.
                                </li>
                                <li>MDS entrega al host externo y espera la respuesta.</li>
                                <li>Devuelve la respuesta a AUTH, incluso aplicando conversiones de formato.</li>
                            </ul>
                            <p>MDS garantiza:</p>
                            <ul>
                                <li>Delivery confiable</li>
                                <li>Retransmisiones</li>
                                <li>Timeouts administrados</li>
                                <li>Balanceo entre destinos</li>
                            </ul>
                        </div>

                        <div class="step-section">
                            <h3>✅ 6. Procesamiento de la Respuesta</h3>
                            <p>AUTH recibe la respuesta (interna o externa) and:</p>
                            <ul>
                                <li>Aplica el <strong>Action Code Profile</strong> para definir el código final.</li>
                                <li>Ajusta datos según el <strong>Issuer Profile</strong>.</li>
                                <li>Actualiza el Journal con el resultado.</li>
                            </ul>
                        </div>

                        <div class="step-section">
                            <h3>✅ 7. Construcción de la respuesta y envío al canal</h3>
                            <p>El Originator arma el mensaje final:</p>
                            <ul>
                                <li>MTI de respuesta</li>
                                <li>Campos obligatorios (ISO8583 o propietario)</li>
                                <li>Datos EMV si aplica</li>
                                <li>Conversión a formato nativo del canal (ATM/POS)</li>
                            </ul>
                            <p>Luego:</p>
                            <ul>
                                <li>Se registra el cierre en el Journal.</li>
                                <li>Se envía la respuesta al canal originador (ATM, POS, app, switch).</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Arquitectura B24 eps Section (Hidden by default) -->
            <div id="arquitectura-section" class="arquitectura-section" style="display: none;">
                <div class="arquitectura-card">
                    <h2>Arquitectura B24 eps</h2>
                    <p>Esta es la sección de Arquitectura B24 eps del proyecto.</p>
                    <div class="arquitectura-content">
                        <div class="info-grid">
                            <div class="info-item">
                                <h3>📐 Diseño</h3>
                                <p>Arquitectura modular y escalable</p>
                            </div>
                            <div class="info-item">
                                <h3>🔧 Componentes</h3>
                                <p>Sistema de componentes reutilizables</p>
                            </div>
                            <div class="info-item">
                                <h3>📊 Estructura</h3>
                                <p>Organización clara y mantenible</p>
                            </div>
                            <div class="info-item">
                                <h3>🚀 Rendimiento</h3>
                                <p>Optimizado para producción</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Componentes B24 Section (Hidden by default) -->
            <div id="componentes-section" class="componentes-section" style="display: none;">
                <div class="componentes-card">
                    <h2>🔧 Componentes B24</h2>
                    <p>Sistema de componentes reutilizables</p>
                    <div class="componentes-content">
                        <div class="info-grid">
                            <div class="info-item">
                                <h3>🧩 UI Components</h3>
                                <p>Componentes de interfaz de usuario</p>
                            </div>
                            <div class="info-item info-item-clickable" id="core-modules-link">
                                <h3>📦 Core Modules</h3>
                                <p>Módulos principales del sistema</p>
                            </div>
                            <div class="info-item">
                                <h3>🔌 API Integration</h3>
                                <p>Integración con servicios externos</p>
                            </div>
                            <div class="info-item">
                                <h3>📚 Documentation</h3>
                                <p>Documentación completa de componentes</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Simuladores B24 Section (Hidden by default) -->
            <div id="simuladores-section" class="simuladores-section" style="display: none;">
                <div class="componentes-card">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                        <span style="font-size: 2rem;">⚙️</span>
                        <h2 style="margin: 0; font-size: 2rem; color: #1a2b4b;">Simuladores B24</h2>
                    </div>
                    <p style="color: #666; font-size: 1.1rem; margin-bottom: 40px;">Simuladores de flujo transaccional y
                        plataformas bancarias.</p>

                    <div class="componentes-grid">
                        <!-- Simulador: ProBank -->
                        <div class="componente-card">
                            <div class="componente-header">
                                <span class="componente-icon">🏦</span>
                                <h3>ProBank</h3>
                            </div>
                            <p class="componente-desc">Plataforma de simulación bancaria para pruebas de core.</p>
                            <div class="componente-preview">
                                <div style="text-align: center;">
                                    <div style="font-size: 2.5rem; margin-bottom: 8px;">💳</div>
                                    <div style="font-size: 0.8rem; color: #64748b; font-weight: 600;">CORE SIMULATOR
                                    </div>
                                </div>
                            </div>
                            <a href="https://pro-bank-five.vercel.app/" target="_blank" class="componente-link">Acceder
                                al Simulador →</a>
                        </div>

                        <!-- Simulador: ATM Flow -->
                        <div class="componente-card">
                            <div class="componente-header">
                                <span class="componente-icon">🏧</span>
                                <h3>ATM Flow</h3>
                            </div>
                            <p class="componente-desc">Simulador de flujo transaccional para cajeros automáticos.</p>
                            <div class="componente-preview">
                                <div style="text-align: center;">
                                    <div style="font-size: 2.5rem; margin-bottom: 8px;">🔄</div>
                                    <div style="font-size: 0.8rem; color: #64748b; font-weight: 600;">TRANSACTION FLOW
                                    </div>
                                </div>
                            </div>
                            <a href="#" class="componente-link">Acceder al Simulador →</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modulos B24 eps Section (Hidden by default) -->
            <div id="modulos-section" class="modulos-section" style="display: none;">
                <div class="modulos-card">
                    <h2>📦 Core Modules</h2>
                    <p>Módulos principales del sistema</p>
                </div>
            </div>

        </main>

    </div>

    <script src="/js/index.js"></script>
    <script>
        // Toggle Sections
        document.addEventListener('DOMContentLoaded', function () {
            const arquitecturaNav = document.querySelector('.nav-item.active');
            const componentesNav = document.getElementById('componentes-nav');
            const simuladoresNav = document.getElementById('simuladores-nav');
            const arquitecturaSection = document.getElementById('arquitectura-section');
            const componentesSection = document.getElementById('componentes-section');
            const simuladoresSection = document.getElementById('simuladores-section');
            const modulosSection = document.getElementById('modulos-section');
            const inicioSection = document.getElementById('inicio-section');

            function hideAllSections() {
                if (arquitecturaSection) arquitecturaSection.style.display = 'none';
                if (componentesSection) componentesSection.style.display = 'none';
                if (simuladoresSection) simuladoresSection.style.display = 'none';
                if (modulosSection) modulosSection.style.display = 'none';
                if (inicioSection) inicioSection.style.display = 'none';
            }

            function showInicioSection() {
                if (inicioSection) inicioSection.style.display = 'block';
            }

            // Toggle Arquitectura Section
            if (arquitecturaNav) {
                arquitecturaNav.addEventListener('click', function (e) {
                    e.preventDefault();

                    if (arquitecturaSection.style.display === 'none' || arquitecturaSection.style.display === '') {
                        hideAllSections();
                        arquitecturaSection.style.display = 'block';
                    } else {
                        hideAllSections();
                        showInicioSection();
                    }
                });
            }

            // Toggle Componentes Section
            if (componentesNav) {
                componentesNav.addEventListener('click', function (e) {
                    e.preventDefault();

                    if (componentesSection.style.display === 'none' || componentesSection.style.display === '') {
                        hideAllSections();
                        componentesSection.style.display = 'block';
                    } else {
                        hideAllSections();
                        showInicioSection();
                    }
                });
            }

            // Toggle Simuladores Section
            if (simuladoresNav) {
                simuladoresNav.addEventListener('click', function (e) {
                    e.preventDefault();

                    if (simuladoresSection.style.display === 'none' || simuladoresSection.style.display === '') {
                        hideAllSections();
                        simuladoresSection.style.display = 'block';
                    } else {
                        hideAllSections();
                        showInicioSection();
                    }
                });
            }

            // Toggle Modulos Section from Core Modules link
            const coreModulesLink = document.getElementById('core-modules-link');

            if (coreModulesLink && modulosSection) {
                coreModulesLink.addEventListener('click', function (e) {
                    e.preventDefault();
                    hideAllSections();
                    modulosSection.style.display = 'block';
                });
            }
        });
    </script>
</body>

</html>